<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NextBizness - Connection Test</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üî¨</text></svg>">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">

    <!-- =========== Single View for Testing =========== -->
    <div id="auth-view" class="min-h-screen flex items-center justify-center">
        <div class="max-w-md w-full bg-white p-8 rounded-xl shadow-2xl">
            
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-2">Connection Test</h2>
            <p class="text-center text-gray-500 mb-8">Let's solve this connection issue. Click the button below.</p>

            <!-- Test Connection Button -->
            <div class="text-center mb-6">
                <button onclick="testConnection()" class="bg-indigo-600 text-white px-8 py-3 rounded-md hover:bg-indigo-700 text-lg font-semibold shadow-lg">1. Click to Test Connection</button>
            </div>
            
            <div id="test-result" class="mt-6 p-4 bg-gray-50 rounded-md text-center hidden">
                <h3 class="font-bold text-lg">Test Result:</h3>
                <p id="test-result-message" class="mt-2 text-md"></p>
            </div>

            <hr class="my-8">

            <!-- Login Form -->
            <div>
                <h2 class="text-xl font-bold text-center text-gray-700 mb-4">2. Try to Login</h2>
                <div id="login-error" class="text-red-500 text-sm mb-4 text-center p-2 bg-red-50 rounded-md border border-red-200 hidden"></div>
                <input type="email" id="login-email" placeholder="Email" class="w-full px-4 py-2 mb-4 border border-gray-300 rounded-md">
                <input type="password" id="login-password" placeholder="Password" class="w-full px-4 py-2 mb-4 border border-gray-300 rounded-md">
                <button onclick="loginUser()" class="w-full bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700 transition font-semibold">Login</button>
            </div>

        </div>
    </div>

    <!-- =========== FIREBASE & JAVASCRIPT =========== -->
    <script type="module">
        // --- FIREBASE SDK IMPORTS ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously,
            signInWithEmailAndPassword
        } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // --- FIREBASE CONFIG (as provided) ---
        const firebaseConfig = {
            apiKey: "AIzaSyAdOpB618-pYq5iHJIErhFeaGUUlJ1KYew",
            authDomain: "nextbuzness.firebaseapp.com",
            projectId: "nextbuzness",
            storageBucket: "nextbuzness.appspot.com",
            messagingSenderId: "9188411983",
            appId: "1:9188411983:web:7e1d7dec6b62aa8965f83a",
            measurementId: "G-EMYW513V6H"
        };

        // --- FIREBASE INITIALIZATION ---
        let app;
        let auth;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
        } catch (error) {
            alert(`CRITICAL ERROR: Firebase could not be initialized. Check your firebaseConfig object. Error: ${error.message}`);
        }
        
        // --- NEW, SIMPLIFIED CONNECTION TEST ---
        window.testConnection = async () => {
            const resultDiv = document.getElementById('test-result');
            const resultMessage = document.getElementById('test-result-message');
            resultDiv.classList.remove('hidden');

            try {
                // This is the simplest possible connection to Firebase Auth.
                // It doesn't require a user or password.
                await signInAnonymously(auth);
                
                // If it succeeds, the server connection is OK.
                const successMessage = "‚úÖ SUCCESS! The website successfully connected to the Firebase Authentication server. The problem is likely with your Firestore Security Rules.";
                resultMessage.innerHTML = successMessage;
                resultMessage.className = "mt-2 text-md text-green-700";
                alert(successMessage);

            } catch (error) {
                // If it fails, the server is blocking the connection.
                const errorMessage = `‚ùå FAILED. The Firebase server blocked the connection. <br><br><strong>Server Error:</strong> "${error.code}" <br><br> This is an API Key or configuration issue in your Google Cloud project. It is not a code error.`;
                resultMessage.innerHTML = errorMessage;
                resultMessage.className = "mt-2 text-md text-red-700";
                alert(`FAILED. The Firebase server blocked the connection. Error code: ${error.code}. This is an API Key configuration issue.`);
            }
        };

        // --- SIMPLIFIED LOGIN FOR TESTING ---
        window.loginUser = async () => {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            errorDiv.classList.add('hidden');

            try {
                await signInWithEmailAndPassword(auth, email, password);
                alert("‚úÖ Login successful! If you see this, everything is working.");
            } catch (error) {
                errorDiv.textContent = `Login failed. Server responded with: ${error.code}`;
                errorDiv.classList.remove('hidden');
            }
        };

    </script>
</body>
</html>


